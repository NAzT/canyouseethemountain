<!DOCTYPE html>
<html>
	<head>
		<title>Can You See The Mountain: Doi Suthep</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<link rel="stylesheet" href="boostrap/css/bootstrap.min.css">

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="leaflet/leaflet.js"></script>

		<style>
			body {
				padding: 0;
				margin: 0;
			}
			html, body {
				height: 100%;
			}

			#map {
				height:200px;
			}

		</style>
	</head>
	<body>
		<div id="map"></div>

		<div class="container">
			<h1>Can you see Doi Suthep?</h1>
			<div class="row well">
				<div class="col-md-12 text-center">
					<img class="img-responsive" src="images/DoiSuthep100.jpg">
					<br>
					<button type="button" class="btn btn-success btn-lg" onclick="sendVisibility(100)">It's Clear</button>
				</div>
			</div>
			<div class="row well">
				<div class="col-md-12 text-center">
					<img class="img-responsive" src="images/DoiSuthep050.jpg">
					<br>
					<button type="button" class="btn btn-warning btn-lg" onclick="sendVisibility(50)">It's Hazy</button>
				</div>
			</div>
			<div class="row well">
				<div class="col-md-12 text-center">
					<img class="img-responsive" src="images/DoiSuthep000.jpg">
					<br>
					<button type="button" class="btn btn-danger btn-lg" onclick="sendVisibility(0)">Can't See It</button>
				</div>
			</div>
		</div>

		<script>
			var map = L.map('map');


			L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="http://cloudmade.com">CloudMade</a>'
			}).addTo(map);

			function onLocationFound(e) {
				radius = e.accuracy / 2;

				L.marker(e.latlng).addTo(map);

				L.circle(e.latlng, radius).addTo(map);
			}

			function onLocationError(e) {
				alert(e.message);
			}

			function sendVisibility(map, radius, visibility){

				//navigator.geolocation.getCurrentPosition();

				alert(map.latlng);

				$.post( "/checkins", { coords: 'coords', landmark_id: 1, visibility: 50 }, function() {
					alert( "Submitted your results" );
				})
				.fail(function() {
					alert( "Error submitting your results" );
				})
			}

			map.on('locationfound', onLocationFound);
			map.on('locationerror', onLocationError);

			map.locate({setView: true, maxZoom: 16});
		</script>
	</body>
</html>